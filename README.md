# ControlFlow - Sistema de Gest√£o de Qualidade Inteligente

## üöÄ Vis√£o Geral

O ControlFlow √© uma plataforma avan√ßada de gest√£o de qualidade que evoluiu de uma ferramenta de registro linear para um sistema proativo e inteligente. Focamos em aprimorar a experi√™ncia do T√©cnico e Analista de Qualidade, fornecendo ferramentas poderosas que simplificam e tornam √† prova de erros a experi√™ncia do Inspetor.

## ‚ú® Funcionalidades Principais

### üéØ M√≥dulo 1: Cria√ß√£o de Planos de Inspe√ß√£o (Analista)

#### Construtor Visual de Fluxo (Flow Builder)
- **Interface Drag-and-Drop**: Cria√ß√£o visual de fluxos de inspe√ß√£o com n√≥s e conex√µes
- **L√≥gica Condicional**: Ramifica√ß√µes baseadas em decis√µes (ex: "Produto Liga?" ‚Üí SIM/N√ÉO)
- **Canvas Interativo**: Zoom, pan e organiza√ß√£o visual dos fluxos
- **Auto-save**: Persist√™ncia autom√°tica do estado do canvas

#### Biblioteca de Crit√©rios Reutiliz√°veis
- **Blocos Pr√©-configurados**: Micro-tarefas com t√≠tulo, instru√ß√£o padr√£o e tipo de resposta
- **Categoriza√ß√£o**: Organiza√ß√£o por tipos e tags para f√°cil localiza√ß√£o
- **M√≠dia de Ajuda**: Fotos, diagramas e v√≠deos anexados aos crit√©rios
- **Reutiliza√ß√£o**: Arrastar blocos para novos planos

#### Crit√©rios Din√¢micos
- **Vari√°veis T√©cnicas**: Sintaxe `{Produto.Atributo.Tens√£o_Nominal}` para valores din√¢micos
- **Integra√ß√£o com Ficha T√©cnica**: Busca autom√°tica de valores durante inspe√ß√£o
- **Flexibilidade**: Crit√©rios que se adaptam ao produto espec√≠fico

#### Assistente de IA Preditiva
- **Sugest√µes Inteligentes**: Bot√£o "‚ú® Sugerir Pontos de Falha" para an√°lise autom√°tica
- **Detec√ß√£o de NCs**: Identifica√ß√£o de poss√≠veis n√£o conformidades relacionadas
- **Integra√ß√£o de Fluxo**: Adi√ß√£o autom√°tica de sugest√µes como novos n√≥s

#### Modo de Simula√ß√£o
- **Valida√ß√£o de Fluxo**: Teste do plano como se fosse o inspetor
- **Verifica√ß√£o de L√≥gica**: Confirma√ß√£o de caminhos condicionais
- **Teste de Instru√ß√µes**: Valida√ß√£o de clareza e completude

### üîç M√≥dulo 2: Execu√ß√£o de Inspe√ß√£o (Inspetor)

#### Execu√ß√£o Guiada e Din√¢mica
- **Interface Wizard**: Apresenta√ß√£o passo a passo das etapas
- **Navega√ß√£o Inteligente**: Pr√≥ximo passo determinado pela resposta anterior
- **Fluxo Condicional**: Seguimento autom√°tico dos caminhos definidos pelo analista

#### Automa√ß√£o de N√£o Conformidades (NC)
- **Detec√ß√£o Autom√°tica**: Mudan√ßa de status para "Pendente com NC"
- **Etapas Espec√≠ficas**: Formul√°rios dedicados para registro de falhas
- **Notifica√ß√µes Autom√°ticas**: Alerta para gestores de qualidade respons√°veis
- **Sistema de Escala√ß√£o**: Prioriza√ß√£o e acompanhamento de NCs

#### Suporte Visual Just-in-Time
- **√çcone de Ajuda**: Acesso imediato √† m√≠dia de ajuda em cada etapa
- **M√≠dia Contextual**: Fotos, diagramas e v√≠deos espec√≠ficos do crit√©rio
- **Instru√ß√µes Visuais**: Guias visuais para execu√ß√£o correta

### üõ°Ô∏è Sistemas Cr√≠ticos (N√çVEL 5 - CR√çTICO M√ÅXIMO)

#### Health Monitor
- **Monitoramento em Tempo Real**: CPU, mem√≥ria, banco de dados, storage
- **Alertas Autom√°ticos**: Notifica√ß√µes de problemas cr√≠ticos
- **M√©tricas de Performance**: Hist√≥rico e an√°lise de tend√™ncias
- **Dashboard de Status**: Vis√£o geral da sa√∫de do sistema

#### Cache Manager
- **Cache Inteligente**: TTL configur√°vel e evi√ß√£o LRU
- **Cache Especializado**: Produtos, inspe√ß√µes e dados frequentes
- **Limpeza Autom√°tica**: Remo√ß√£o de dados expirados
- **Estat√≠sticas de Performance**: M√©tricas de hit/miss ratio

#### Security Manager
- **Middleware de Seguran√ßa**: Valida√ß√£o de entrada, XSS, SQL Injection
- **Prote√ß√£o contra Ataques**: Rate limiting e prote√ß√£o brute force
- **Auditoria de Seguran√ßa**: Logs de eventos e tentativas de acesso
- **Bloqueio de IPs**: Prote√ß√£o contra IPs maliciosos

#### Backup Manager
- **Backups Autom√°ticos**: Banco de dados, uploads e logs
- **Compress√£o e Criptografia**: Otimiza√ß√£o de espa√ßo e seguran√ßa
- **Pol√≠tica de Reten√ß√£o**: Limpeza autom√°tica de backups antigos
- **Restaura√ß√£o Simplificada**: Processo de recupera√ß√£o guiado

### üç™ Sistema de Cookies Inteligente

#### Persist√™ncia de Estado
- **Prefer√™ncias do Usu√°rio**: Tema, idioma, configura√ß√µes de interface
- **Estado do Flow Builder**: Posi√ß√£o do canvas, zoom, n√≥s selecionados
- **Sess√µes de Inspe√ß√£o**: Progresso atual e dados tempor√°rios
- **Cache Inteligente**: Dados frequentes com TTL configur√°vel

#### Auto-save e Restaura√ß√£o
- **Salvamento Autom√°tico**: Baseado em prefer√™ncias do usu√°rio
- **Restaura√ß√£o de Estado**: Recupera√ß√£o de posi√ß√µes e configura√ß√µes
- **Sincroniza√ß√£o**: Manuten√ß√£o de estado entre sess√µes
- **Configura√ß√µes Avan√ßadas**: Controle granular de comportamento

## üèóÔ∏è Arquitetura T√©cnica

### Frontend
- **React 18**: Interface moderna e responsiva
- **TypeScript**: Tipagem est√°tica para maior confiabilidade
- **Shadcn/ui**: Componentes de UI consistentes e acess√≠veis
- **Framer Motion**: Anima√ß√µes suaves e transi√ß√µes
- **Hooks Customizados**: Gerenciamento de estado e l√≥gica de neg√≥cio

### Backend
- **Node.js + Express**: API REST robusta e escal√°vel
- **Supabase**: Banco de dados PostgreSQL com autentica√ß√£o
- **Drizzle ORM**: Mapeamento objeto-relacional type-safe
- **Sistema de Logs**: Rastreamento completo de opera√ß√µes
- **Middleware de Seguran√ßa**: Prote√ß√£o em m√∫ltiplas camadas

### Banco de Dados
- **PostgreSQL**: Banco relacional robusto
- **Row Level Security (RLS)**: Controle granular de acesso
- **√çndices Otimizados**: Performance para consultas complexas
- **Triggers Autom√°ticos**: Atualiza√ß√£o de timestamps e auditoria

## üöÄ Como Executar

### Pr√©-requisitos
- Node.js 18+
- Docker e Docker Compose
- Supabase (conta e projeto configurado)

### Configura√ß√£o Local
```bash
# Clone o reposit√≥rio
git clone <repository-url>
cd ControlFlow

# Instale as depend√™ncias
npm install

# Configure as vari√°veis de ambiente
cp env.example .env.local
# Edite .env.local com suas credenciais do Supabase

# Execute o banco de dados local (opcional)
docker-compose up -d postgres

# Inicie o servidor de desenvolvimento
npm run dev
```

### Configura√ß√£o Docker
```bash
# Iniciar todos os servi√ßos
docker-compose up -d

# Ver logs
docker-compose logs -f

# Parar servi√ßos
docker-compose down
```

### Configura√ß√£o Supabase
1. Crie um projeto no Supabase
2. Execute as migra√ß√µes SQL fornecidas
3. Configure as vari√°veis de ambiente
4. Teste a conex√£o com `npm run test:supabase`

## üìä Estrutura do Banco de Dados

### Tabelas Principais
- `inspection_plans`: Planos de inspe√ß√£o base
- `flow_nodes`: N√≥s do fluxo de inspe√ß√£o
- `flow_connections`: Conex√µes entre n√≥s
- `flow_plans`: Planos de fluxo completos
- `criteria_blocks`: Blocos de crit√©rios reutiliz√°veis
- `smart_inspections`: Execu√ß√µes inteligentes de inspe√ß√£o
- `nc_notifications`: Sistema de notifica√ß√µes de NC
- `system_health_logs`: Logs de sa√∫de do sistema
- `security_events`: Eventos de seguran√ßa
- `backup_info`: Informa√ß√µes de backup

## üß™ Testes

### Testes Automatizados
```bash
# Testes unit√°rios
npm run test

# Testes de integra√ß√£o
npm run test:integration

# Testes espec√≠ficos
npm run test:critical-systems
npm run test:cookie-system
npm run test:supabase
```

### Scripts de Teste
- `test-critical-systems.js`: Testa sistemas cr√≠ticos
- `test-cookie-system.js`: Valida sistema de cookies
- `test-supabase-connection.js`: Verifica conex√£o com Supabase

## üìö Documenta√ß√£o Adicional

- [Configura√ß√£o do Supabase](./docs/SUPABASE_SETUP.md)
- [Sistema de Cookies](./docs/COOKIE_SYSTEM.md)
- [Sistemas Cr√≠ticos](./docs/CRITICAL_SYSTEMS.md)
- [Flow Builder](./docs/FLOW_BUILDER.md)
- [Smart Inspection](./docs/SMART_INSPECTION.md)
- [Deploy no Render](./docs/RENDER_DEPLOY.md)

## üîß Configura√ß√µes Avan√ßadas

### Vari√°veis de Ambiente
```bash
# Supabase
SUPABASE_URL=your-supabase-url
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Sistema
NODE_ENV=development
PORT=3000
JWT_SECRET=your-jwt-secret

# Uploads
MAX_FILE_SIZE=10485760
UPLOAD_DIR=./uploads

# Cache
CACHE_TTL=3600
CACHE_MAX_SIZE=100

# Backup
BACKUP_DIR=./backups
BACKUP_RETENTION_DAYS=30
```

### Configura√ß√µes de Performance
- **Cache TTL**: Tempo de vida dos dados em cache
- **Rate Limiting**: Limites de requisi√ß√µes por IP
- **Upload Limits**: Tamanho m√°ximo de arquivos
- **Backup Frequency**: Frequ√™ncia de backups autom√°ticos

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üÜò Suporte

- **Issues**: Use o sistema de issues do GitHub
- **Documenta√ß√£o**: Consulte a pasta `docs/`
- **Testes**: Execute os scripts de teste para diagn√≥stico
- **Logs**: Verifique os logs do sistema para troubleshooting

## üéØ Roadmap

### Pr√≥ximas Vers√µes
- [ ] Integra√ß√£o com sistemas externos de qualidade
- [ ] Relat√≥rios avan√ßados e analytics
- [ ] Mobile app nativo
- [ ] Machine Learning para sugest√µes de NC
- [ ] Integra√ß√£o com IoT para inspe√ß√µes automatizadas

### Melhorias Cont√≠nuas
- [ ] Otimiza√ß√£o de performance
- [ ] Novos tipos de crit√©rios
- [ ] Sistema de templates de planos
- [ ] Integra√ß√£o com calend√°rio
- [ ] Notifica√ß√µes push

---

**ControlFlow** - Transformando a gest√£o de qualidade em uma experi√™ncia inteligente e proativa. üöÄ
